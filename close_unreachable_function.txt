

def close_decision_as_unreachable(
    db: Session,
    decision_id: int
) -> Optional[Decision]:
    """
    Close a decision as unreachable (when threshold > current members).
    Sets status to 'expired_unreachable' and closed_at timestamp.
    Preserves all vote history.
    """
    decision = db.query(Decision).filter(Decision.id == decision_id).first()
    if decision is None:
        logger.warning(f"Decision #{decision_id} not found for unreachable close")
        return None
    
    if decision.status != "pending":
        logger.warning(f"Decision #{decision_id} is not pending, cannot close as unreachable")
        return None
    
    decision.status = "expired_unreachable"
    decision.closed_at = datetime.utcnow()
    
    try:
        db.commit()
        db.refresh(decision)
        logger.info(f"ðŸ”’ Closed decision #{decision_id} as unreachable")
        return decision
    except Exception as exc:
        logger.error(f"Database error in close_decision_as_unreachable: {exc}")
        db.rollback()
        return None
